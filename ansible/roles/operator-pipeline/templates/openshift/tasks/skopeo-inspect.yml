---
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: skopeo-inspect
spec:
  params:
    - name: image
      description: reference to the existing index image
    - name: registry
      description: Registry that contains index image
  workspaces:
    - name: registry-credentials
      description: Docker config for retrieving the index image
  results:
    - name: skopeo_result
  steps:
    - name: skopeo-inspect
      image: registry.redhat.io/rhel8/skopeo:8.4-13
      script: |
        set -xe pipefail

        skopeo login $(params.registry) --authfile $(workspaces.credentials.path)/.dockerconfigjson \

        skopeo inspect $(params.image) | tee $(results.skopeo_result.path)
